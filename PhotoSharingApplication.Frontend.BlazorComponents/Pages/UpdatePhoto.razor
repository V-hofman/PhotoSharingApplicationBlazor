@page "/photos/update/{id:int}"

@using PhotoSharingApplication.Frontend.BlazorComponents.Components
@using PhotoSharingApplication.Shared.Interfaces
@using PhotoSharingApplication.Shared.Entities
@inject IPhotosService photosService
@inject NavigationManager navigationManager

<PageTitle>Update Photo @photo?.Title</PageTitle>

<PageTitle>Update Photo</PageTitle>
<EditForm Model="@photo">
    <MudItem xs="12" sm="7">
        <PhotoDetailsComponent Photo="photo" EditConfirm Delete OnUpdate="HandleValidSubmit">

        </PhotoDetailsComponent>
        <InputFile id="fileInput112" OnChange="@UploadFiles" />
    </MudItem>
</EditForm>


@code {
    [Parameter]
    public int Id { get; set; }

    Photo? photo;

    protected override async Task OnInitializedAsync()
    {
        photo = await photosService.FindAsync(Id);
    }

    private async Task HandleValidSubmit()
    {
        await photosService.UpdateAsync(photo!);
        navigationManager.NavigateTo("/photos/all");
    }

    private async Task UploadFiles(InputFileChangeEventArgs e)
    {
        var entries = e.GetMultipleFiles();
        if (entries is null)
        {
            return;
        }
        photo!.ImageMimeType = e.File.ContentType;

        using (var stream = new System.IO.MemoryStream())
        {
            var streamRead = e.File.OpenReadStream();
            await streamRead.CopyToAsync(stream);
            photo.PhotoFile = stream.ToArray();
        }
    }
}